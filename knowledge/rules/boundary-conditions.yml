name: Boundary Conditions
description: >
  Numeric values, counters, and data displays should handle
  minimum, maximum, zero, and overflow states.

rules:
  - id: counter-boundaries
    name: Counter/badge has no boundary handling
    severity: info
    annotation_target: element
    description: >
      Numeric displays like notification badges, counters, or pagination
      should handle zero, very large numbers (99+), and negative values.
    triggers:
      component_names:
        - Badge
      layer_name_patterns:
        - "(?i)(count|badge|notification|unread|total|quantity|amount)"
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.4
      visual_match: 0.2
      threshold: 0.5
    finding_template:
      title: "No boundary handling for {{element_name}} counter"
      description: "This numeric counter has no visible handling for zero, very large (99+), or negative values."
      recommendation: "Show how the counter behaves at zero, at a capped max value (e.g. 99+), and ensure no negative display."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(zero|empty|overflow|99\\+|max|limit)"]
    recommendation:
      message: >
        Show how this counter behaves at its boundaries: zero items,
        maximum display value (e.g., 99+), and potentially negative numbers.
      components:
        - shadcn_id: badge
          label: "Overflow Badge (99+)"

  - id: pagination-boundaries
    name: Pagination has no first/last page state
    severity: warning
    annotation_target: element
    description: >
      Pagination controls should handle the first page (no previous button)
      and last page (no next button) states.
    triggers:
      layer_name_patterns:
        - "(?i)(pagination|paging|page.?\\d|prev|next)"
      component_names:
        - Pagination
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.4
    finding_template:
      title: "No first/last page state for {{element_name}} pagination"
      description: "This pagination has no visible disabled state for boundary pages. Users may try to navigate past the first or last page."
      recommendation: "Disable the 'previous' button on page 1 and the 'next' button on the last page."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(disabled|first|last|no.?more)"]
    recommendation:
      message: >
        Show pagination at its boundaries — first page with disabled
        "previous" and last page with disabled "next".
      components:
        - shadcn_id: button
          variant: disabled
          label: "Disabled Pagination Button"

  - id: file-upload-limits
    name: File upload has no visible size/type limit
    severity: warning
    annotation_target: screen
    description: >
      File upload areas should communicate maximum file size, accepted
      file types, and dimension constraints before the user selects a file —
      not just reject it after upload fails.
    triggers:
      layer_name_patterns:
        - "(?i)(upload|drop.?zone|file.?input|attach|import.?file|avatar|photo|image)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.2
      visual_match: 0.3
      threshold: 0.4
    finding_template:
      title: "No visible constraints for {{element_name}} file upload"
      description: "This file upload has no visible size or format limits. Users will only discover constraints after a failed upload."
      recommendation: "Show max file size, accepted formats, and dimension limits directly in the upload area before selection."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(max.?size|file.?size|limit|mb|gb|accept|allowed|format|type)"]
    recommendation:
      message: >
        Show file upload constraints upfront — max size, accepted formats,
        and dimension limits. Display this information in the upload area
        before the user selects a file, not as an error after the fact.
      components:
        - shadcn_id: card
          label: "Upload Drop Zone"
        - shadcn_id: form-message
          label: "File Constraint Hint"

  - id: list-scaling
    name: List has no handling for very few or very many items
    severity: info
    annotation_target: screen
    description: >
      Lists and grids should handle extreme quantities gracefully — a single
      item should look intentional (not broken), and thousands of items
      should use pagination, infinite scroll, or virtualisation to prevent
      performance issues.
    triggers:
      pattern_types:
        - list
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.3
      visual_match: 0.3
      threshold: 0.5
    finding_template:
      title: "No scaling handling for {{element_name}} list"
      description: "This list has no visible pagination or load-more pattern. Very large datasets may cause performance issues."
      recommendation: "Add pagination or infinite scroll for large lists, and ensure a single-item state looks intentional."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(pagination|load.?more|infinite|scroll|showing|of.?\\d|page|virtual)"]
        - component_names: ["Pagination"]
      in_flow:
        - layer_name_patterns: ["(?i)(pagination|page.?\\d|load.?more|single.?item|few.?items)"]
    recommendation:
      message: >
        Design for quantity extremes — show how this list looks with 1 item,
        a typical amount, and a very large dataset. Add pagination or infinite
        scroll for large lists and ensure the single-item state isn't awkward.
      components:
        - shadcn_id: button
          label: "Load More Button"

  - id: date-range-validation
    name: Date range has no invalid-range handling
    severity: warning
    annotation_target: element
    description: >
      Date range pickers should prevent or handle the case where the end
      date is before the start date, and where both dates are the same.
      Use constraints to prevent invalid ranges rather than just catching
      them after submission.
    triggers:
      layer_name_patterns:
        - "(?i)(date.?range|start.?date|end.?date|from.?date|to.?date|check.?in|check.?out|depart|return)"
      component_names:
        - DatePicker
        - Calendar
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.4
    finding_template:
      title: "No invalid-range handling for {{element_name}} date picker"
      description: "This date range picker has no visible constraint preventing end dates before start dates. Users may submit invalid ranges."
      recommendation: "Disable invalid dates in the picker UI and show a clear error if an invalid range is somehow entered."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(invalid|error|constraint|disabled|min.?date|max.?date)"]
    recommendation:
      message: >
        Add validation for date ranges — prevent end dates before start dates
        using picker constraints (disable invalid dates), and show a clear
        error if an invalid range is somehow entered.
      components:
        - shadcn_id: form-message
          variant: destructive
          label: "Invalid Range Message"
