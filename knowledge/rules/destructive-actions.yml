name: Destructive Actions
description: >
  Actions that delete, remove, or irreversibly modify data should require
  explicit confirmation to prevent accidental data loss.

rules:
  - id: delete-no-confirmation
    name: Destructive action has no confirmation dialog
    severity: critical
    annotation_target: element
    description: >
      This destructive action (delete, remove, clear) has no visible
      confirmation step. Users might accidentally trigger it and lose data.
    triggers:
      pattern_types:
        - destructive-action
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.3
    finding_template:
      title: "No confirmation for \"{{element_text}}\" destructive action"
      description: "The \"{{element_text}}\" action has no confirmation step. Users may accidentally trigger it and lose data."
      recommendation: "Add an Alert Dialog with a clear description of the consequences and a prominent cancel option."
    expects:
      in_screen:
        - component_names: ["AlertDialog", "Alert Dialog", "Dialog", "Modal"]
        - layer_name_patterns: ["(?i)(confirm|are.?you.?sure|modal|dialog|alert|warning|popup)"]
      in_flow:
        - component_names: ["AlertDialog", "Alert Dialog", "Dialog"]
        - layer_name_patterns: ["(?i)(confirm.?delete|confirm.?remove|are.?you.?sure|confirmation)"]
    recommendation:
      message: >
        Add a confirmation dialog before this destructive action. Use an
        Alert Dialog with a clear description of what will happen and a
        prominent cancel option.
      components:
        - shadcn_id: alert-dialog
          label: "Confirmation Dialog"
        - shadcn_id: button
          variant: destructive
          label: "Destructive Action Button"

  - id: no-undo
    name: Destructive action has no undo option
    severity: info
    annotation_target: element
    description: >
      After completing a destructive action, providing an undo option
      (like a toast with an undo button) adds a safety net.
    triggers:
      pattern_types:
        - destructive-action
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.3
      visual_match: 0.3
      threshold: 0.5
    finding_template:
      title: "No undo option after \"{{element_text}}\" action"
      description: "This destructive action has no undo path. Users who accidentally delete will have no way to recover."
      recommendation: "Add an undo toast after the action completes, giving users a brief window to reverse it."
    expects:
      in_flow:
        - component_names: ["Toast", "Sonner"]
        - layer_name_patterns: ["(?i)(undo|restore|recover)"]
    recommendation:
      message: >
        Consider adding an undo toast after destructive actions complete,
        giving users a brief window to reverse the action.
      components:
        - shadcn_id: toast
          label: "Undo Toast"
        - shadcn_id: button
          variant: outline
          label: "Undo Button"

  - id: vague-confirmation-label
    name: Destructive confirmation uses vague button labels
    severity: warning
    annotation_target: element
    description: >
      Confirmation dialogs for destructive actions should use specific
      button labels like "Delete Account" or "Remove Item" — not generic
      labels like "Confirm", "OK", or "Yes". WCAG and NNG both recommend
      unambiguous labels that state exactly what will happen.
    triggers:
      layer_name_patterns:
        - "(?i)(confirm|are.?you.?sure|delete.?dialog|remove.?dialog)"
      component_names:
        - AlertDialog
        - Alert Dialog
        - Dialog
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.4
    finding_template:
      title: "Vague button labels in {{element_name}} confirmation dialog"
      description: "This confirmation dialog may use generic labels like 'OK' or 'Confirm'. Users need specific labels describing the destructive consequence."
      recommendation: "Use specific button labels like 'Delete Account' or 'Remove Item' that clearly state the action."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(delete.+button|remove.+button|cancel.+subscription|specific.?label)"]
    recommendation:
      message: >
        Use specific button labels in confirmation dialogs — "Delete Account"
        not "Confirm", "Remove Item" not "OK". The label should clearly state
        the destructive consequence so users know exactly what they're agreeing to.
      components:
        - shadcn_id: button
          variant: destructive
          label: "Specific Action Button"
        - shadcn_id: alert-dialog
          label: "Confirmation Dialog"

  - id: unsaved-changes-guard
    name: No unsaved changes warning on navigation
    severity: warning
    annotation_target: screen
    description: >
      Forms and editors with unsaved changes should warn users before
      they navigate away or close the tab. Accidentally losing a long
      form entry or document edits is one of the most frustrating user
      experiences.
    triggers:
      pattern_types:
        - form
      layer_name_patterns:
        - "(?i)(edit|form|compose|draft|editor|create|write|configure)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library|search|filter)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.2
      visual_match: 0.3
      threshold: 0.4
    finding_template:
      title: "No unsaved changes guard on {{element_name}} form"
      description: "This form has no visible unsaved changes warning. Users may lose work if they accidentally navigate away."
      recommendation: "Add a confirmation dialog asking users to save, discard, or cancel when navigating away with unsaved edits."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(unsaved|discard|leave.?page|changes.?will.?be.?lost|save.?before)"]
      in_flow:
        - layer_name_patterns: ["(?i)(unsaved.?changes|discard.?changes|leave.?without.?saving)"]
    recommendation:
      message: >
        Add an unsaved changes guard — when users try to navigate away from
        a form with unsaved edits, show a confirmation dialog asking if they
        want to save, discard, or cancel navigation.
      components:
        - shadcn_id: alert-dialog
          label: "Unsaved Changes Dialog"
        - shadcn_id: button
          label: "Save Changes Button"
        - shadcn_id: button
          variant: outline
          label: "Discard Button"

  - id: irreversible-submission-review
    name: Irreversible submission has no review step
    severity: critical
    annotation_target: screen
    description: >
      Submissions with legal, financial, or data-commitment consequences
      should include a review/summary step before final submission (WCAG
      3.3.4 / 3.3.6). This lets users verify all information before
      committing to an action that cannot be undone.
    triggers:
      layer_name_patterns:
        - "(?i)(place.?order|submit.?payment|pay.?now|confirm.?purchase|sign.?contract|accept.?terms|finalize)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library|order.?history|past.?orders)"]
    confidence_signals:
      name_match: 0.6
      component_match: 0.2
      visual_match: 0.2
      threshold: 0.3
    finding_template:
      title: "No review step before {{element_text}} submission"
      description: "This irreversible submission has no review/summary step. Users cannot verify their information before committing."
      recommendation: "Add a review step showing all entered data with an option to go back and edit before final submission."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(review|summary|confirm|verify|order.?summary|preview)"]
      in_flow:
        - layer_name_patterns: ["(?i)(review.?step|order.?summary|confirmation.?page|preview)"]
    recommendation:
      message: >
        Add a review/summary step before this irreversible submission. Per WCAG
        3.3.4, submissions that cause legal or financial commitments must be
        reversible, checked for errors, or confirmed via a review step.
      components:
        - shadcn_id: card
          label: "Order/Submission Summary"
        - shadcn_id: button
          label: "Edit/Go Back Button"
