name: Error States
description: >
  Interactive elements should have corresponding error and validation states
  so users understand what went wrong and how to fix it.

rules:
  - id: form-field-errors
    name: Form fields missing error states
    severity: critical
    annotation_target: element
    description: >
      Text inputs, selects, and other form fields should show an error
      variant when validation fails, with a helpful message below.
    triggers:
      component_names:
        - Input
        - Textarea
        - Select
        - Combobox
        - DatePicker
        - RadioGroup
        - Checkbox
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar|breadcrumb)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.4
      visual_match: 0.2
      threshold: 0.5
    finding_template:
      title: "Missing error state for {{element_name}} form field"
      description: "The {{element_name}} field has no visible error variant. Users who fail validation will see no inline feedback."
      recommendation: "Add an error variant with red border, error icon, and descriptive message below the field."
    expects:
      in_screen:
        - component_names: ["Input", "Textarea", "Select"]
          with_properties:
            State: "Error"
        - layer_name_patterns: ["(?i)(error|invalid|validation|destructive|failed|alert)"]
        - component_names: ["FormMessage", "Form Message", "FormDescription", "HelperText", "ErrorMessage"]
        - with_visual_cues: ["error"]
      in_flow:
        - layer_name_patterns: ["(?i)(error|validation|invalid|alert|warning)"]
        - with_visual_cues: ["error"]
    recommendation:
      message: >
        Add error variants for form fields with descriptive validation
        messages. Users need to know what went wrong and how to fix it.
      components:
        - shadcn_id: input
          variant: error
          label: "Input (Error State)"
        - shadcn_id: form-message
          variant: destructive
          label: "Form Validation Message"

  - id: submit-error-feedback
    name: No error handling for form submission
    severity: critical
    annotation_target: element
    description: >
      Forms with submit actions should handle submission failures
      (server errors, network issues, validation errors).
    triggers:
      layer_name_patterns:
        - "(?i)(submit|save|send|create|update|confirm|sign.?in|log.?in|register)"
      pattern_types:
        - button
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|toolbar|pagination)"]
      screen_name_patterns: ["(?i)(styleguide|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.5
    finding_template:
      title: "No error feedback for \"{{element_text}}\" submission"
      description: "The \"{{element_text}}\" button has no associated error state. Users will see no feedback if submission fails."
      recommendation: "Add an inline alert or toast notification showing the error with a clear recovery action."
    expects:
      in_screen:
        - component_names: ["Alert", "Toast", "Sonner"]
        - layer_name_patterns: ["(?i)(error|fail|alert|toast|notification)"]
        - with_visual_cues: ["error"]
      in_flow:
        - layer_name_patterns: ["(?i)(error|fail|something.?went.?wrong)"]
        - with_visual_cues: ["error"]
    recommendation:
      message: >
        Add error feedback for form submission — show an inline alert or
        toast notification explaining what went wrong and how to recover.
      components:
        - shadcn_id: alert
          variant: destructive
          label: "Error Alert"
        - shadcn_id: toast
          variant: destructive
          label: "Error Toast Notification"

  - id: search-no-results
    name: Search has no "no results" state
    severity: warning
    annotation_target: screen
    description: >
      Search or filter functionality should show a clear state when no
      results match the query, guiding users on what to do next.
    triggers:
      pattern_types:
        - search
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.4
    finding_template:
      title: "Missing \"no results\" state for search"
      description: "The search/filter has no visible empty results state. Users whose queries return nothing will see no guidance."
      recommendation: "Add a 'no results' state with a helpful message and suggestions to broaden search criteria."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(no.?results|not.?found|empty|zero|nothing)"]
      in_flow:
        - layer_name_patterns: ["(?i)(no.?results|not.?found|empty)"]
    recommendation:
      message: >
        Add a "no results" state for search/filter — show a helpful message
        with suggestions to broaden the search criteria.
      components:
        - shadcn_id: card
          label: "No Results Card"
        - shadcn_id: button
          label: "Clear Filters Button"

  - id: form-data-preservation
    name: Form data not preserved after error
    severity: warning
    annotation_target: screen
    description: >
      When a form submission fails (validation error, server error), the
      user's entered data should be preserved so they don't have to re-type
      everything. Baymard found 34% of sites don't retain credit card data
      after a validation error.
    triggers:
      pattern_types:
        - form
      layer_name_patterns:
        - "(?i)(checkout|payment|register|sign.?up|profile|order)"
    exclude:
      screen_name_patterns: ["(?i)(success|confirmation|thank|receipt)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.3
      visual_match: 0.3
      threshold: 0.5
    finding_template:
      title: "Form data may not persist after submission error"
      description: "This {{flow_context}} form has no visible error-with-preserved-data state. Users may lose entered data on failure."
      recommendation: "Design an error state that shows validation messages while keeping all user-entered data intact."
    expects:
      in_flow:
        - layer_name_patterns: ["(?i)(error.?state|validation|retry|error.?form|preserved|retained)"]
    recommendation:
      message: >
        Ensure form data is preserved when validation or submission fails.
        Users should never have to re-enter information they already provided,
        especially sensitive data like payment details or long form fields.
      components:
        - shadcn_id: form-message
          variant: destructive
          label: "Inline Validation Message"
        - shadcn_id: alert
          variant: destructive
          label: "Submission Error Alert"

  - id: error-accessibility
    name: Error indicators may rely on colour alone
    severity: warning
    annotation_target: element
    description: >
      Error states should use colour AND an icon AND text to communicate
      the error — not colour alone. This is an accessibility requirement
      (WCAG 1.4.1) since colour-blind users may miss colour-only indicators.
    triggers:
      component_names:
        - Input
        - Textarea
        - Select
      layer_name_patterns:
        - "(?i)(error|invalid|destructive|warning|alert)"
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.3
      visual_match: 0.3
      threshold: 0.5
    finding_template:
      title: "Error state for {{element_name}} may rely on colour alone"
      description: "Error indicators should use colour + icon + text (WCAG 1.4.1). Colour-blind users may miss colour-only errors."
      recommendation: "Add an error icon and descriptive text alongside the colour change for accessibility compliance."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(error.?icon|warning.?icon|alert.?icon|exclamation|error.?message|validation.?message|helper.?text|form.?message|hint)"]
        - component_names: ["FormMessage", "Form Message", "FormDescription", "HelperText"]
      in_flow:
        - layer_name_patterns: ["(?i)(error.?icon|validation.?message|error.?text|helper)"]
    recommendation:
      message: >
        Ensure error states use colour, an icon, and descriptive text together —
        not colour alone. This meets WCAG 1.4.1 and helps colour-blind users
        identify errors clearly.
      components:
        - shadcn_id: form-message
          variant: destructive
          label: "Error Message with Icon"

  - id: password-strength-feedback
    name: No password strength indicator
    severity: info
    annotation_target: screen
    description: >
      Sign-up and password change flows should provide real-time password
      strength feedback so users can create strong passwords without
      guessing the requirements.
    triggers:
      layer_name_patterns:
        - "(?i)(password|new.?password|create.?password|change.?password|sign.?up|register)"
    exclude:
      screen_name_patterns: ["(?i)(login|sign.?in|forgot|reset)"]
    confidence_signals:
      name_match: 0.6
      component_match: 0.2
      visual_match: 0.2
      threshold: 0.4
    finding_template:
      title: "No password strength feedback on signup"
      description: "Password creation has no visible strength indicator. Users cannot gauge if their password meets requirements."
      recommendation: "Add a strength meter showing specific criteria (length, special chars) that updates as the user types."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(strength|strong|weak|requirement|criteria|rule|meter)"]
      in_flow:
        - layer_name_patterns: ["(?i)(password.?strength|password.?requirement|password.?rule)"]
    recommendation:
      message: >
        Add a password strength indicator that shows requirements in real time.
        Display specific criteria (length, special characters, etc.) and
        mark each as met or unmet as the user types.
      components:
        - shadcn_id: progress
          label: "Password Strength Meter"
        - shadcn_id: form-message
          label: "Password Requirements List"

  - id: widget-data-error
    name: Dashboard widget has no error/retry state
    severity: warning
    annotation_target: screen
    description: >
      Individual dashboard widgets that load data from APIs should show
      an error state with a retry option when their data source fails,
      rather than showing stale or blank content.
    triggers:
      layer_name_patterns:
        - "(?i)(widget|chart|graph|metric|stat|kpi|analytics|report)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.2
      visual_match: 0.3
      threshold: 0.4
    finding_template:
      title: "No error/retry state for {{element_name}} widget"
      description: "This data widget has no visible error state. If the data source fails, users will see stale or blank content."
      recommendation: "Add an error card with a clear message and retry button that re-fetches without a full page reload."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(error|fail|unavailable|retry|reload|refresh)"]
      in_flow:
        - layer_name_patterns: ["(?i)(widget.?error|data.?error|load.?fail|retry)"]
    recommendation:
      message: >
        Add an error state for this widget when its data source fails. Show
        a clear message explaining the data couldn't load and a retry button
        to re-fetch without reloading the entire page.
      components:
        - shadcn_id: card
          label: "Widget Error Card"
        - shadcn_id: button
          label: "Retry Button"
