name: Edge Inputs
description: >
  Form inputs should handle edge cases like extreme lengths,
  special characters, and unusual formatting gracefully.

rules:
  - id: no-character-limit
    name: Text input has no visible character limit
    severity: info
    annotation_target: element
    description: >
      Long-form text inputs (textareas, name fields, bio fields) should
      show a character counter or limit to prevent truncation surprises.
    triggers:
      component_names:
        - Textarea
        - Input
      layer_name_patterns:
        - "(?i)(bio|description|comment|message|note|textarea|long.?text)"
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.5
    finding_template:
      title: "No character limit shown for {{element_name}} input"
      description: "This text input has no visible character counter or limit. Users may hit unexpected truncation on submission."
      recommendation: "Add a character counter showing current/max length so users know the limit before they exceed it."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(counter|count|limit|max|character|remaining|\\d+\\/\\d+|chars)"]
    recommendation:
      message: >
        Add a character counter or limit indicator so users know the
        maximum allowed length before hitting unexpected truncation.
      components:
        - shadcn_id: form-message
          label: "Character Counter"

  - id: text-overflow
    name: Long text content may overflow
    severity: info
    annotation_target: screen
    description: >
      Displayed text content (names, titles, descriptions) should handle
      very long values gracefully — with truncation, wrapping, or tooltips.
    triggers:
      layer_name_patterns:
        - "(?i)(name|title|label|heading|username|email|url|description)"
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar|breadcrumb)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.2
      visual_match: 0.4
      threshold: 0.5
    finding_template:
      title: "Text overflow not handled for {{element_name}}"
      description: "This displayed text has no visible truncation or overflow handling. Very long content may break the layout."
      recommendation: "Add text truncation with ellipsis and a tooltip showing the full value on hover."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(truncat|ellipsis|overflow|wrap|tooltip)"]
    recommendation:
      message: >
        Consider how this text behaves with very long content. Add text
        truncation with a tooltip showing the full value on hover.
      components:
        - shadcn_id: tooltip
          label: "Overflow Tooltip"

  - id: no-input-masking
    name: Structured input has no format mask or hint
    severity: warning
    annotation_target: element
    description: >
      Structured data fields (phone numbers, credit cards, dates, postal codes)
      should use input masking or format hints to guide entry. Baymard found
      64% of sites don't use input masking for phone fields and 80% don't
      auto-format credit card numbers with spaces.
    triggers:
      layer_name_patterns:
        - "(?i)(phone|tel|card.?number|credit.?card|expir|cvv|cvc|zip|postal|date|ssn|iban)"
      component_names:
        - Input
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.4
    finding_template:
      title: "No format mask for {{element_name}} input"
      description: "This structured input has no visible masking or format hint. Users must guess the expected format."
      recommendation: "Add input masking that auto-formats values as the user types (e.g. card numbers with spaces, phone with dashes)."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(mask|format|placeholder|hint|pattern|\\+1|###|XX\\/XX)"]
    recommendation:
      message: >
        Add input masking or a format hint for this structured field. Auto-format
        values as the user types (e.g. card numbers with spaces, phone numbers
        with dashes). This reduces errors and speeds up entry.
      components:
        - shadcn_id: input
          label: "Masked Input Field"
        - shadcn_id: form-message
          label: "Format Hint"

  - id: special-characters-i18n
    name: Input may not handle special characters or i18n
    severity: info
    annotation_target: screen
    description: >
      Name fields, usernames, and text inputs should handle special characters
      gracefully — including emojis, accented letters (e.g. é, ñ, ü), apostrophes,
      hyphens, RTL text, and Unicode characters. Rejecting valid names like
      "O'Brien" or "José" is a common and frustrating edge case.
    triggers:
      layer_name_patterns:
        - "(?i)(name|first.?name|last.?name|username|display.?name|full.?name)"
      component_names:
        - Input
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.5
    finding_template:
      title: "{{element_name}} input may not handle special characters"
      description: "This name/text field may reject valid characters like apostrophes, accented letters, or Unicode. Users with non-ASCII names will be blocked."
      recommendation: "Ensure the field accepts apostrophes, hyphens, accented letters, and Unicode without restrictive ASCII-only validation."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(i18n|unicode|special|international|locale|accent)"]
      in_flow:
        - layer_name_patterns: ["(?i)(international|locale|special.?char)"]
    recommendation:
      message: >
        Ensure this name or text field accepts special characters including
        apostrophes, hyphens, accented letters, and Unicode. Don't restrict
        inputs to ASCII — real names contain characters like O'Brien, José,
        and emoji display names.
      components:
        - shadcn_id: input
          label: "Unicode-Safe Input"
        - shadcn_id: form-message
          label: "Input Validation Message"
