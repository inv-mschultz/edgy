name: Loading States
description: >
  Content that depends on async data fetching should show loading
  indicators to communicate system status to users.

rules:
  - id: data-loading-skeleton
    name: No loading state for data-dependent content
    severity: warning
    annotation_target: screen
    description: >
      This screen displays data that likely comes from an API but has
      no visible loading skeleton or spinner for the initial load.
    triggers:
      pattern_types:
        - list
        - data-display
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.3
      visual_match: 0.3
      threshold: 0.4
    finding_template:
      title: "No loading state for {{element_name}} content"
      description: "This data-dependent screen has no visible loading skeleton or spinner. Users will see a blank area during fetch."
      recommendation: "Add a loading skeleton that mimics the content layout for better perceived performance."
    expects:
      in_screen:
        - component_names: ["Skeleton"]
        - layer_name_patterns: ["(?i)(loading|skeleton|shimmer|placeholder|spinner|progress|fetching)"]
      in_flow:
        - component_names: ["Skeleton", "Spinner", "Progress"]
        - layer_name_patterns: ["(?i)(loading|skeleton|shimmer)"]
    recommendation:
      message: >
        Add a loading skeleton that mimics the layout of the actual content.
        This provides a better perceived performance than a generic spinner.
      components:
        - shadcn_id: skeleton
          label: "Content Skeleton"
        - shadcn_id: progress
          label: "Progress Indicator"

  - id: button-loading
    name: No loading state for async button action
    severity: warning
    annotation_target: element
    description: >
      Buttons that trigger async operations (submit, save, send) should
      show a loading state to prevent double-clicks and communicate progress.
    triggers:
      layer_name_patterns:
        - "(?i)(submit|save|send|create|update|upload|import|export|sync)"
      pattern_types:
        - button
    exclude:
      parent_name_patterns: ["(?i)(nav|header|footer|sidebar|menu|toolbar)"]
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.3
      visual_match: 0.2
      threshold: 0.4
    finding_template:
      title: "No loading state for \"{{element_text}}\" button"
      description: "The \"{{element_text}}\" button has no loading variant. Users may double-click during async operations."
      recommendation: "Add a loading spinner inside the button and disable it during the async operation."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(loading|spinner|progress|saving|sending)"]
        - component_names: ["Button"]
          with_properties:
            State: "Loading"
      in_flow:
        - layer_name_patterns: ["(?i)(loading|progress|pending)"]
    recommendation:
      message: >
        Add a loading variant for this button — show a spinner inside the
        button and disable it during the async operation.
      components:
        - shadcn_id: button
          variant: loading
          label: "Button (Loading State)"

  - id: page-loading
    name: No initial page loading state
    severity: info
    annotation_target: screen
    description: >
      Pages that fetch data on mount should show an initial loading state
      before content is available.
    triggers:
      pattern_types:
        - data-display
        - list
      layer_name_patterns:
        - "(?i)(detail|profile|dashboard|feed|inbox|timeline|activity)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.3
      visual_match: 0.3
      threshold: 0.5
    finding_template:
      title: "No initial loading state for {{element_name}} page"
      description: "This page fetches data on mount but has no loading skeleton. Users will see an empty page briefly before content appears."
      recommendation: "Add skeleton placeholders matching the content layout to display during the initial data fetch."
    expects:
      in_screen:
        - component_names: ["Skeleton", "Spinner"]
        - layer_name_patterns: ["(?i)(loading|skeleton|shimmer|placeholder|fetching)"]
      in_flow:
        - layer_name_patterns: ["(?i)(loading|skeleton|splash|fetching)"]
    recommendation:
      message: >
        Consider adding an initial loading state for this page with
        skeleton placeholders matching the content layout.
      components:
        - shadcn_id: skeleton
          label: "Page Skeleton"

  - id: payment-processing-state
    name: No payment processing state
    severity: critical
    annotation_target: screen
    description: >
      Payment processing is a high-anxiety moment — users need clear
      feedback that their payment is being processed, a warning not to
      close or navigate away, and a path to check order status if
      something goes wrong.
    triggers:
      layer_name_patterns:
        - "(?i)(pay|payment|checkout|purchase|order|buy.?now|place.?order|complete.?order)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library|order.?history|past.?orders)"]
    confidence_signals:
      name_match: 0.6
      component_match: 0.2
      visual_match: 0.2
      threshold: 0.3
    finding_template:
      title: "No processing state for {{flow_context}} payment"
      description: "This payment flow has no visible processing state. Users will see no feedback during a high-anxiety moment."
      recommendation: "Add a processing overlay with a progress indicator, a 'do not close' warning, and a fallback path to check order status."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(processing|completing|please.?wait|do.?not.?close|finalizing)"]
      in_flow:
        - layer_name_patterns: ["(?i)(processing|payment.?loading|order.?status|confirming)"]
    recommendation:
      message: >
        Add a clear payment processing state with a progress indicator,
        a "please don't close this page" message, and a fallback path
        to check order status if the process takes too long or fails.
      components:
        - shadcn_id: progress
          label: "Payment Progress"
        - shadcn_id: alert
          label: "Do Not Close Warning"
