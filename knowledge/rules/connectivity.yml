name: Connectivity
description: >
  Screens that depend on network connectivity should handle
  offline states, timeouts, and reconnection gracefully.

rules:
  - id: no-offline-indicator
    name: No offline/connectivity indicator
    severity: info
    annotation_target: screen
    description: >
      Screens that explicitly sync, stream, or rely on real-time server
      connections should communicate when the device is offline.
    triggers:
      layer_name_patterns:
        - "(?i)(sync|real.?time|live.?feed|stream|websocket|chat|messaging|collaboration|video.?call|vpn|connection.?status)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.5
      component_match: 0.2
      visual_match: 0.3
      threshold: 0.5
    finding_template:
      title: "No offline indicator for {{element_name}} screen"
      description: "This real-time or sync-dependent screen has no connectivity indicator. Users will see no feedback when the network drops."
      recommendation: "Add a connectivity banner or overlay that appears when offline, with a retry option."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(offline|no.?connection|network|retry|reconnect|connection.?lost|no.?internet|unavailable)"]
      in_flow:
        - layer_name_patterns: ["(?i)(offline|no.?connection|network.?error|connection.?lost|no.?internet)"]
    recommendation:
      message: >
        Add a connectivity error state — a banner or overlay that appears
        when the network is unavailable, with a retry option.
      components:
        - shadcn_id: alert
          variant: destructive
          label: "Connectivity Alert"
        - shadcn_id: button
          label: "Retry Button"

  - id: timeout-state
    name: No timeout/slow connection handling
    severity: info
    annotation_target: screen
    description: >
      Long-running operations should handle timeout scenarios — show a
      message if the request is taking longer than expected.
    triggers:
      layer_name_patterns:
        - "(?i)(upload|import|export|generate|process|sync)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.2
      visual_match: 0.4
      threshold: 0.5
    finding_template:
      title: "No timeout handling for {{element_name}} operation"
      description: "This long-running operation has no timeout state. Users will see no feedback if the request stalls or takes too long."
      recommendation: "Add a timeout message with options to retry or cancel when the operation exceeds expected duration."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(timeout|slow|taking.?long|retry|cancel)"]
      in_flow:
        - layer_name_patterns: ["(?i)(timeout|failed|retry)"]
    recommendation:
      message: >
        Add timeout handling — show a message when the operation is taking
        longer than expected with options to retry or cancel.
      components:
        - shadcn_id: alert
          label: "Timeout Alert"
        - shadcn_id: button
          label: "Cancel/Retry Button"
        - shadcn_id: progress
          label: "Progress Indicator"

  - id: form-auto-save
    name: Form has no auto-save or local persistence
    severity: info
    annotation_target: screen
    description: >
      Long or multi-step forms should auto-save progress locally so users
      don't lose all their input if the connection drops, the browser crashes,
      or they accidentally navigate away. NNG emphasises that losing form data
      is one of the most frustrating user experiences.
    triggers:
      pattern_types:
        - form
      layer_name_patterns:
        - "(?i)(checkout|application|registration|onboarding|wizard|multi.?step|survey|booking)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library|login|sign.?in)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.2
      visual_match: 0.4
      threshold: 0.5
    finding_template:
      title: "No auto-save for {{element_name}} form"
      description: "This multi-step or long form has no auto-save. Users who lose connectivity or accidentally close the tab will lose all progress."
      recommendation: "Persist form progress to local storage and show a 'draft saved' indicator for user reassurance."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(auto.?save|saved|draft|persist|resume|recover)"]
      in_flow:
        - layer_name_patterns: ["(?i)(auto.?save|draft|saved|resume.?progress)"]
    recommendation:
      message: >
        Add auto-save for this form — persist progress to local storage
        so users can resume if they lose connectivity or accidentally
        close the tab. Show a "draft saved" indicator for reassurance.
      components:
        - shadcn_id: badge
          label: "Draft Saved Indicator"
        - shadcn_id: toast
          label: "Auto-Save Confirmation"

  - id: stale-data-indicator
    name: Data display has no freshness indicator
    severity: info
    annotation_target: screen
    description: >
      Screens that display real-time or frequently-updated data should show
      a "last updated" timestamp or freshness indicator. When data may be
      stale (e.g. dashboard went offline briefly), users need to know they
      might not be seeing current information.
    triggers:
      layer_name_patterns:
        - "(?i)(dashboard|analytics|monitor|live|real.?time|feed|status|metric|report)"
    exclude:
      screen_name_patterns: ["(?i)(styleguide|design.?system|component.?library)"]
    confidence_signals:
      name_match: 0.4
      component_match: 0.2
      visual_match: 0.4
      threshold: 0.5
    finding_template:
      title: "No freshness indicator for {{element_name}} data"
      description: "This real-time data display has no 'last updated' timestamp. Users cannot tell if they are viewing current or stale information."
      recommendation: "Add a 'last updated' timestamp and a manual refresh button, with a stale-data warning when data is old."
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(last.?updated|refreshed|ago|timestamp|stale|live|as.?of)"]
    recommendation:
      message: >
        Add a "last updated" timestamp or freshness indicator so users
        know how current the displayed data is. Include a manual refresh
        option and show a stale-data warning if the data hasn't been
        updated recently.
      components:
        - shadcn_id: badge
          label: "Last Updated Badge"
        - shadcn_id: button
          label: "Refresh Button"
