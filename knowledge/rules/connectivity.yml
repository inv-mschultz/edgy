name: Connectivity
description: >
  Screens that depend on network connectivity should handle
  offline states, timeouts, and reconnection gracefully.

rules:
  - id: no-offline-indicator
    name: No offline/connectivity indicator
    severity: warning
    annotation_target: screen
    description: >
      Screens that fetch or submit data should communicate when the
      device is offline or experiencing connectivity issues.
    triggers:
      pattern_types:
        - form
        - data-display
        - list
      layer_name_patterns:
        - "(?i)(api|fetch|load|sync|upload|download)"
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(offline|no.?connection|network|retry|reconnect)"]
      in_flow:
        - layer_name_patterns: ["(?i)(offline|no.?connection|network.?error)"]
    recommendation:
      message: >
        Add a connectivity error state — a banner or overlay that appears
        when the network is unavailable, with a retry option.
      components:
        - shadcn_id: alert
          variant: destructive
          label: "Connectivity Alert"
        - shadcn_id: button
          label: "Retry Button"

  - id: timeout-state
    name: No timeout/slow connection handling
    severity: info
    annotation_target: screen
    description: >
      Long-running operations should handle timeout scenarios — show a
      message if the request is taking longer than expected.
    triggers:
      layer_name_patterns:
        - "(?i)(upload|import|export|generate|process|sync)"
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(timeout|slow|taking.?long|retry|cancel)"]
      in_flow:
        - layer_name_patterns: ["(?i)(timeout|failed|retry)"]
    recommendation:
      message: >
        Add timeout handling — show a message when the operation is taking
        longer than expected with options to retry or cancel.
      components:
        - shadcn_id: alert
          label: "Timeout Alert"
        - shadcn_id: button
          label: "Cancel/Retry Button"
        - shadcn_id: progress
          label: "Progress Indicator"

  - id: form-auto-save
    name: Form has no auto-save or local persistence
    severity: info
    annotation_target: screen
    description: >
      Long or multi-step forms should auto-save progress locally so users
      don't lose all their input if the connection drops, the browser crashes,
      or they accidentally navigate away. NNG emphasises that losing form data
      is one of the most frustrating user experiences.
    triggers:
      pattern_types:
        - form
      layer_name_patterns:
        - "(?i)(checkout|application|registration|onboarding|wizard|multi.?step|survey|booking)"
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(auto.?save|saved|draft|persist|resume|recover)"]
      in_flow:
        - layer_name_patterns: ["(?i)(auto.?save|draft|saved|resume.?progress)"]
    recommendation:
      message: >
        Add auto-save for this form — persist progress to local storage
        so users can resume if they lose connectivity or accidentally
        close the tab. Show a "draft saved" indicator for reassurance.
      components:
        - shadcn_id: badge
          label: "Draft Saved Indicator"
        - shadcn_id: toast
          label: "Auto-Save Confirmation"

  - id: stale-data-indicator
    name: Data display has no freshness indicator
    severity: info
    annotation_target: screen
    description: >
      Screens that display real-time or frequently-updated data should show
      a "last updated" timestamp or freshness indicator. When data may be
      stale (e.g. dashboard went offline briefly), users need to know they
      might not be seeing current information.
    triggers:
      layer_name_patterns:
        - "(?i)(dashboard|analytics|monitor|live|real.?time|feed|status|metric|report)"
    expects:
      in_screen:
        - layer_name_patterns: ["(?i)(last.?updated|refreshed|ago|timestamp|stale|live|as.?of)"]
    recommendation:
      message: >
        Add a "last updated" timestamp or freshness indicator so users
        know how current the displayed data is. Include a manual refresh
        option and show a stale-data warning if the data hasn't been
        updated recently.
      components:
        - shadcn_id: badge
          label: "Last Updated Badge"
        - shadcn_id: button
          label: "Refresh Button"
